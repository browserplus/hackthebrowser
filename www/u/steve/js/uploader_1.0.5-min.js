if(typeof BPTool=="undefined"||!BPTool){var BPTool={}}BPTool.Uploader=typeof BPTool.Uploader!="undefined"&&BPTool.Uploader?BPTool.Uploader:function(){var D=1;var C=false;var A={UPLOAD:"uploaded",ADD:"add",REMOVE:"remove",SELECT:"select",UNSELECT:"unselect"};var L={TOOBIG:"toobig",TOOMANY:"toomany",MIMETYPE:"mimetype"};var H='<div style="position:relative; width:100%; height:100%; padding:0; background:{uploadBackground}; font:{uploadFont}">    <div style="color:{titleColor};">        <div style="position:absolute; top:10px; left:32px;">{fileLabel}</div>        <div style="position:absolute; top:10px; right:110px;">{sizeLabel}</div>        <div style="position:absolute; top:10px; right:24px;">{removeLabel}</div>    </div>    <div id="{dzid}" style="position:absolute; top:24px; left:16px; {filesWidth}; {filesHeight}; border:{fileBorder}; background:{fileBackground}; overflow-y:auto;overflow-x:hidden;">        {files}    </div>    <div style="position:absolute; bottom:16px; left:16px; {filesWidth}; height:29px; border:{footerBorder}; color:{footerColor}; background:{footerBackground}; font:{footerFont};">        <div style="position:absolute; bottom:7px; left:10px; width:200px;">{numfiles}</div>        <div style="position:absolute; bottom:7px; left:64px; width:200px; "><a id="{browseButton}" style="color:{footerColor};" href="#">{browseLabel}</a></div>        <div style="position:absolute; bottom:7px; right:80px;">{totalLabel}: {total}</div>        <div style="position:absolute; bottom:7px; right:5px; visibility:{vupload};"><a id="{uploadButton}" style="color:{footerColor};" href="#">{uploadLabel}</a></div>    </div></div>';var B='<div id="{dzid}_file{index}" style="position:relative; width:100%; height:20px; color:{fileColor};cursor:default;">   <div id="{dzid}_prog{index}" style="position:absolute; width:0%; height:20px;"></div>   <div style="position:absolute; top:5px; left: 10px;">{fname}</div>   <div style="position:absolute; top:5px; right:80px;">{fsize}</div>   <div title="{trashLabel}" class="{dzid}_remove" style="position:absolute; top:7px; right:22px; width:10px; height:10px;background:transparent url(http://l.yimg.com/g/images/upload/trash_can.gif) no-repeat; margin-left:15px; text-decoration:none;"></div></div>';var K='<div style="width:100%; height:100%; padding:0; background:#f7f7f7; font-size:10pt; font-family:Tahoma,Verdana,Arial,Sans-Serif;">    <div style="padding:20px;">        To use the advanced uploader you must first install Yahoo BrowserPlus&trade;.         <a target="_blank" href="{url}">Click here</a> to install BrowserPlus.          Installation will take just a few minutes and not require a browser restart.    </div></div>';var E='<div style="position:relative; width:100%; height:100%; padding:0; background:#f7f7f7; font-family:Arial,Sans-Serif;"">    <div style="position:absolute; top:16px; left:16px; bottom:16px; right:16px; background:#fff; border:1px solid #ccc;">        <div style="position:relative; top:15px; left:20px; font-size:11pt; font-weight:bold; ">Loading Advanced Uploader...</div>        <div style="position:absolute; top:35px; right:20px; left:20px; height:17px; border:1px solid #e4e4e4;width:200px;">           <div style="width:{percentage}%; height:17px; background:#666;"></div>        </div>    </div></div>';var G='<div style="position:relative; width:100%; height:100%; background:#f7f7f7; font-size:10pt; font-family:Tahoma,Verdana,Arial,Sans-Serif;">    <div style="padding:20px;">        <div style="font-weight:bold; padding:0 0 16px 0">Error loading Yahoo! BrowserPlus&trade;</div>        <div style="padding:0 0 10px 0;">Please report this error to the website administrator:</div>        <div style="padding:8px; background:#ddd; font-family:monospace;font-size:9pt;">{error}</div>    </div></div>';function M(){return"ybpt_uploader_dz_"+D++}function J(b,Q){var U,T,S,X,Y,a,W=[],R,V=" ",P="{",Z="}";for(;;){U=b.lastIndexOf(P);if(U<0){break}T=b.indexOf(Z,U);if(U+1>=T){break}R=b.substring(U+1,T);X=R;a=null;S=X.indexOf(V);if(S>-1){a=X.substring(S+1);X=X.substring(0,S)}Y=Q[X];b=b.substring(0,U)+Y+b.substring(T+1)}for(U=W.length-1;U>=0;U=U-1){b=b.replace(new RegExp("~-"+U+"-~"),"{"+W[U]+"}","g")}return b}function I(P){if(P){return(typeof P.length==="number"&&isFinite(P.length)&&typeof P.splice==="function")}return false}function O(P){return(P&&(typeof P==="object"||typeof P==="function"))||false}function F(P){var Q,R={};for(Q=0;Q<P.length;Q++){R[P[Q]]=1}return R}function N(R,Q){var P;if(Q){for(P in Q){if(Q.hasOwnProperty(P)&&R.hasOwnProperty(P)){R[P]=Q[P]}}}return R}return{create:function(S,T){var Q=S;var R=null;var P={fileCB:null,postCB:null,constraintCB:null,uploadCompleteCB:null,uploadUrl:null,fileVarName:"file",maxFileSize:0,maxFiles:0,mimeTypes:null,uploadBackground:"#f7f7f7",uploadFont:"8pt tahoma,sans-serif",titleColor:"#666",fileLabel:"File",sizeLabel:"Size",removeLabel:"Remove?",trashLabel:"Remove file from list",fileBorder:"1px solid #ccc",fileBackground:"#fff",fileColor:"#666",selectBackground:"#006adb",selectColor:"#fff",browseLabel:"Browse...",uploadLabel:"Upload",hoverBackground:"#ffd",progressBackground:"#ccc",progressBorderColor:"#f08",footerBackground:"#eee",footerFont:"bold 8pt tahoma,sans-serif",footerBorder:"1px solid #ccc",footerColor:"#000",fileLabel:"File",filesLabel:"Files",totalLabel:"Total"};if(typeof S!="string"){throw"BPTool.Uploader.create() requires a string argument which is the id of a div into which an advanced uploader is rendered."}P=N(P,T);if(I(P.mimeTypes)&&P.mimeTypes.length>0){R=F(P.mimeTypes)}return function(){var b=M();var Y=b+"browse";var V=b+"upload";var e=[];var l=null;function h(r){var q,p=[" B"," KB"," MB"," GB"," TB"];for(q=0;r>1024;q++){r/=1024}return Math.round(r*10)/10+p[q]}function d(p){return b+"_"+p.BrowserPlusHandleID}function n(p,r,q){if(P.fileCB){P.fileCB({success:true,action:r,name:p.name,size:p.size,mime:p.mimeType,id:Q,uuid:d(p),value:q})}}function k(p,q){if(P.constraintCB){P.constraintCB({constraint:q,name:p.name,size:p.size,mime:p.mimeType,id:Q})}}function W(){var q=document.getElementById(b);var p=document.createTextNode(".");q.appendChild(p);q.removeChild(p)}function Z(p){var q=document.getElementById(S);if(!q){throw ("No such id: '"+S+'"')}q.innerHTML=J(K,{url:p})}function f(p){var q=document.getElementById(S);if(!q){throw ("No such id: '"+S+'"')}q.innerHTML=J(G,{error:p})}function i(p){var q=document.getElementById(S);if(!q){throw ("No such id: '"+S+'"')}q.innerHTML=J(E,{percentage:p.totalPercentage})}function U(r,q){var p=document.getElementById(r);if(q){p.className=b+"_selected";p.style.backgroundColor=P.selectBackground;p.style.color=P.selectColor}else{p.className="";p.style.backgroundColor="";p.style.color=P.fileColor}}function j(t){var p,s,r;for(var q=0;q<t.length;q++){r=t[q];if(P.maxFiles>0&&e.length>=P.maxFiles){k(r,L.TOOMANY);break}if(P.maxFileSize>0&&r.size>P.maxFileSize){k(r,L.TOOBIG);continue}if((!R||R[r.mimeType]===1)&&r.mimeType!="application/x-folder"){n(r,A.ADD);e.push(r)}else{if(R&&!R[r.mimeType]){k(r,L.MIMETYPE);continue}}}m()}function o(p){var q=document.getElementById(b);q.style.background=p?P.hoverBackground:P.fileBackground;W()}function c(u){var s,q,r,t;if(!C){u=u||window.event;s=u.target||u.srcElement;if(s&&3==s.nodeType){s=s.parentNode}if(s.className==(b+"_remove")){q=s.parentNode.id.match(/[0-9]+$/);if(q[0]){if(l){n(e[l.match(/[0-9]+$/)[0]],A.UNSELECT);l=null}n(e[q[0]],A.REMOVE);e.splice(q[0],1);m()}}else{r=new RegExp(b+"_file[0-9]+");t=null;if(r.test(s.id)){t=s}else{if(r.test(s.parentNode.id)){t=s.parentNode}}if(t){if(l){U(l,false);n(e[l.match(/[0-9]+$/)[0]],A.UNSELECT);if(t.id!=l){U(t.id,true);l=t.id;n(e[l.match(/[0-9]+$/)[0]],A.SELECT)}else{l=null}}else{U(t.id,true);l=t.id;n(e[l.match(/[0-9]+$/)[0]],A.SELECT)}}else{if(l){U(l,false);n(e[l.match(/[0-9]+$/)[0]],A.UNSELECT);l=null}}}}}function X(p){var q=P.mimeTypes?{mimeTypes:P.mimeTypes}:{};BrowserPlus.FileBrowse.OpenBrowseDialog(q,function(r){if(r.success){j(r.value)}});return false}function g(p){if(P.uploadUrl){if(l){U(l,false);n(e[l.match(/[0-9]+$/)[0]],A.UNSELECT);l=null}a();if(document.getElementById(V)){document.getElementById(V).style.visibility="hidden"}return false}}function m(){var t,p="",w,q=0,x,s,r,v,u;r=document.getElementById(S);s=r.offsetHeight?("height:"+(r.offsetHeight-72)+"px"):"bottom:48px";x=r.offsetWidth?("width:"+(r.offsetWidth-32)+"px"):"right:16px";for(t=0;t<e.length;t++){w="";if(e[t].size){w=h(e[t].size);q+=e[t].size}p+=J(B,{index:t,fname:e[t].BrowserPlusHandleName,fsize:w,dzid:b,trashLabel:P.trashLabel,fileColor:P.fileColor})}v={filesHeight:s,filesWidth:x,dzid:b,browseButton:Y,uploadButton:V,numfiles:e.length+" "+(e.length===1?P.fileLabel:P.filesLabel),total:h(q),vupload:(e.length>0&&!C?"visible":"hidden"),files:p};for(u in P){if(P.hasOwnProperty(u)){v[u]=P[u]}}r.innerHTML=J(H,v);BrowserPlus.DragAndDrop.RemoveDropTarget({id:b},function(){BrowserPlus.DragAndDrop.AddDropTarget({id:b},function(y){if(y.success){BrowserPlus.DragAndDrop.AttachCallbacks({id:b,hover:o,drop:j},function(){})}})});document.getElementById(b).onclick=c;document.getElementById(Y).onclick=X;document.getElementById(V).onclick=g;if(l){U(l,true)}}function a(){var r,t="",p=document.getElementById(b+"_prog0");if(e.length===0){C=false;if(P.uploadCompleteCB){P.uploadCompleteCB({success:true,id:Q})}return false}C=true;p.style.borderRight="2px solid "+P.progressBorderColor;p.style.background=P.progressBackground;function x(s){p.style.width=Math.min(s.filePercent,100)+"%";W()}function v(y){if(y.success){var s=e[0];e.shift();m();n(s,A.UPLOAD,y.value);a()}else{if(P.fileCB){P.fileCB({success:false,error:y.error,verboseError:y.verboseError,id:Q})}if(P.uploadCompleteCB){P.uploadCompleteCB({success:false,id:Q})}C=false;m()}}var u,w={},q={};w[P.fileVarName]=e[0];u={url:P.uploadUrl,progressCallback:x,files:w,cookies:document.cookie};if(P.postCB){q=P.postCB(d(e[0]));if(O(q)){u.postvars=q}}BrowserPlus.Uploader.upload(u,v);return false}return{render:function(){BrowserPlus.init({},function(p){if(p.success){BrowserPlus.require({services:[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"}],progressCallback:i},function(q){if(q.success){m()}else{var r=q.verboseError?q.verboseError:q.error;f("problem loading services: "+r)}})}else{if(p.error==="bp.notInstalled"){Z("http://browserplus.yahoo.com/install")}}})}}}()}}}();